<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<div class="app-container">
  <div class="app-inner">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <div class="logo-icon">$</div>
        <h1>Optimisateur REER vs CELI</h1>
      </div>
      <p class="subtitle">Fiscalit√© Qu√©bec ‚Äî Visualisez l'impact en temps r√©el</p>
    </div>

    <div class="main-grid">
      <!-- Left panel -->
      <div>
        <div class="panel">
          <div class="panel-label">Param√®tres</div>

          <app-slider icon="üíº" label="Salaire brut" [value]="salary" (valueChange)="salary = $event" [min]="15000" [max]="300000" [step]="1000"></app-slider>
          <app-slider icon="üè†" label="Revenus locatifs nets" [value]="locatif" (valueChange)="locatif = $event" [min]="0" [max]="100000" [step]="500"></app-slider>

          <div class="divider"></div>

          <app-slider icon="üíµ" label="Budget total √† investir" [value]="totalBudget" (valueChange)="totalBudget = $event" [min]="0" [max]="50000" [step]="1000"></app-slider>

          <div class="divider"></div>

          <app-slider icon="üìä" label="Cotisation REER" [value]="reerContrib" (valueChange)="reerContrib = $event" [min]="0" [max]="maxReerContrib" [step]="1000"></app-slider>
          <app-slider icon="üõ°Ô∏è" label="Cotisation CELI" [value]="celiContrib" (valueChange)="celiContrib = $event" [min]="0" [max]="maxCeliContrib" [step]="500"></app-slider>

          <div class="divider"></div>

          <app-slider icon="üìÖ" label="Espace REER disponible" [value]="reerSpace" (valueChange)="reerSpace = $event" [min]="0" [max]="200000" [step]="1000"></app-slider>
          <app-slider icon="üìÖ" label="Espace CELI disponible" [value]="celiSpace" (valueChange)="celiSpace = $event" [min]="0" [max]="200000" [step]="1000"></app-slider>

          <div class="divider"></div>

          <!-- Years slider (custom inline) -->
          <div style="margin-bottom: 8px">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px">
              <label class="years-label">
                <span style="font-size: 16px">üìÜ</span>
                √âtaler sur combien d'ann√©es
              </label>
              <span class="years-value">{{ years }} an{{ years > 1 ? 's' : '' }}</span>
            </div>
            <input
              type="range"
              [min]="1"
              [max]="5"
              [step]="1"
              [value]="years"
              (input)="years = +$any($event.target).value"
              style="width: 100%; accent-color: #f59e0b; height: 6px; cursor: pointer"
            />
          </div>
        </div>

        <app-optimal-split
          [salary]="salary"
          [locatif]="locatif"
          [totalContrib]="totalBudget"
          [reerSpace]="reerSpace"
          [celiSpace]="celiSpace"
        ></app-optimal-split>
      </div>

      <!-- Right panel -->
      <div class="right-column">
        <!-- Key metrics -->
        <div class="metrics-row">
          <app-stat-card
            label="Taux marginal avant"
            [value]="taxService.formatPct(marginalBefore)"
            [sublabel]="'Revenu: ' + taxService.formatMoney(totalIncome)"
          ></app-stat-card>
          <app-stat-card
            label="Taux marginal apr√®s"
            [value]="taxService.formatPct(marginalAfter)"
            [sublabel]="'Revenu: ' + taxService.formatMoney(incomeAfterReer)"
          ></app-stat-card>
          <app-stat-card
            [accent]="true"
            label="√âconomie d'imp√¥t REER"
            [value]="taxService.formatMoney(taxSaved)"
            [sublabel]="'Taux moy. de d√©duction: ' + taxService.formatPct(avgDeductionRate)"
          ></app-stat-card>
        </div>

        <!-- Bracket visualization -->
        <div class="panel">
          <div class="section-title">Paliers d'imposition combin√©s (QC + Fed)</div>
          <div class="section-subtitle">La zone hachur√©e montre la portion d√©duite par le REER</div>
          <app-bracket-bar
            [brackets]="brackets"
            [income]="totalIncome"
            [afterIncome]="incomeAfterReer"
          ></app-bracket-bar>
        </div>

        <!-- Multi-year breakdown -->
        <div class="panel">
          <div class="section-title">
            {{ years > 1 ? '√âtalement sur ' + years + ' ans' : 'Cotisation en 1 an' }}
          </div>

          <div class="year-list">
            @for (sy of savingsPerYear; track sy.year) {
              <div class="year-row">
                <div class="year-badge">{{ sy.year }}</div>
                <div style="flex: 1">
                  <div class="year-contrib">REER: {{ taxService.formatMoney(sy.contrib) }}</div>
                  <div class="year-rate">Taux moyen: {{ taxService.formatPct(sy.avgRate) }}</div>
                </div>
                <div style="text-align: right">
                  <div class="year-saved">{{ taxService.formatMoney(sy.saved) }}</div>
                  <div class="year-return-label">retour</div>
                </div>
              </div>
            }
          </div>

          <div class="total-row">
            <span class="total-label">Total √©conomie sur {{ years }} an{{ years > 1 ? 's' : '' }}</span>
            <span class="total-value">{{ taxService.formatMoney(totalSavedMultiYear) }}</span>
          </div>

          @if (years > 1) {
            <div [class]="spreadBetter ? 'spread-indicator better' : (spreadWorse ? 'spread-indicator worse' : 'spread-indicator neutral')">
              @if (spreadBetter) {
                ‚úì √âtaler = {{ taxService.formatMoney(spreadDiff) }} de plus qu'en 1 an
              } @else if (spreadWorse) {
                √âtaler = {{ taxService.formatMoney(-spreadDiff) }} de moins qu'en 1 an
              } @else {
                M√™me r√©sultat qu'en 1 an
              }
            </div>
          }
        </div>

        <!-- Projection chart -->
        <div class="panel">
          <app-projection-chart
            [reerContrib]="reerPerYear"
            [celiContrib]="celiContrib"
            [years]="10"
          ></app-projection-chart>
        </div>

        <!-- Family Allowance Impact -->
        <app-family-allowance
          [familyIncome]="totalIncome"
          [reerContrib]="reerContrib"
        ></app-family-allowance>

        <!-- Other Credits Impact -->
        <app-credits-impact
          [familyIncome]="totalIncome"
          [workIncome]="salary"
          [reerContrib]="reerContrib"
        ></app-credits-impact>
      </div>
    </div>

    <div class="footer">
      ‚ö†Ô∏è Outil √† titre indicatif seulement ‚Äî Consultez un fiscaliste pour une planification personnalis√©e
    </div>
  </div>
</div>
